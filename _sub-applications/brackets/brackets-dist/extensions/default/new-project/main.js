!function(){function e(e,t,n,r,o,i){t[e]&&(n.push(e),(t[e]===!0||1===t[e])&&r.push(o+e+"/"+i))}function t(e,t,n,r,o){var i=r+t+"/"+o;require._fileExists(e.toUrl(i+".js"))&&n.push(i)}function n(e,t,r){var o;for(o in t)!t.hasOwnProperty(o)||e.hasOwnProperty(o)&&!r?"object"==typeof t[o]&&n(e[o],t[o],r):e[o]=t[o]}var r=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(o){var i=o.config?o.config():{};return{version:"2.0.1+",load:function(o,a,s,l){l=l||{},l.locale&&(i.locale=l.locale);var c,u,f,d=r.exec(o),E=d[1],p=d[4],g=d[5],R=p.split("-"),_=[],v={},m="";if(d[5]?(E=d[1],c=E+g):(c=o,g=d[4],p=i.locale,p||(p=i.locale="undefined"==typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),R=p.split("-")),l.isBuild){for(_.push(c),t(a,"root",_,E,g),u=0;u<R.length;u++)f=R[u],m+=(m?"-":"")+f,t(a,m,_,E,g);a(_,function(){s()})}else a([c],function(t){var r,o=[];for(e("root",t,o,_,E,g),u=0;u<R.length;u++)r=R[u],m+=(m?"-":"")+r,e(m,t,o,_,E,g);a(_,function(){var e,r,i;for(e=o.length-1;e>-1&&o[e];e--)i=o[e],r=t[i],(r===!0||1===r)&&(r=a(E+i+"/"+g)),n(v,r);s(v)})})}}})}(),define("nls/strings",["require","exports","module"],function(e,t,n){n.exports={root:!0,fr:!0,de:!0,it:!0}}),define("nls/root/strings",{MY_DOCUMENTS:"My Documents",DOCUMENTS:"Documents",MENU_TITLE:"New Project…",NEW_PROJECT_BASE_NAME:"Untitled-",CHANGE:"Change…",PROJECT_DIRECTORY_lABEL:"Parent Folder:",CHOOSE_TEMPLATE_LABEL:"Template:",PROJECT_NAME_LABEL:"Name:",DIALOG_TITLE:"Create New Project",NO_TEMPLATE_OPTION_LABEL:"None (Empty Project)",ERROR_NOT_A_DIRECTORY:"Unable to write to {1} because it is not a valid directory, the volume is offline or does not exist.",ERROR_DIRECTORY_ALREADY_EXISTS:"Unable to create the project directory {1} because it already exists.",ERROR_UNABLE_TO_WRITE_DIRECTORY:"unable to write to {1} (Error {0})",INVALID_PROJECT_NAME:"Invalid Project Name",INVALID_PROJECT_NAME_MESSAGE:"Project names cannot contain the following characters: /?*:;{}<>\\| or use any system reserved words.",ONE_OR_MORE_TEMPLATE_FILES_FAILED:"Unable to copy all template files to the destination folder. One or more copy operations failed."}),define("strings",["require","exports","module","i18n!nls/strings"],function(e,t,n){n.exports=e("i18n!nls/strings")}),define("text",["module"],function(e){var t,n,r,o,i,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,u=c&&location.protocol&&location.protocol.replace(/\:/,""),f=c&&location.hostname,d=c&&(location.port||void 0),E={},p=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=a[t];try{e=new ActiveXObject(n)}catch(r){}if(e){a=[n];break}}return e},parseName:function(e){var t,n,r,o=!1,i=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==i&&(!a||i>1)?(t=e.substring(0,i),n=e.substring(i+1,e.length)):t=e,r=n||t,i=r.indexOf("!"),-1!==i&&(o="strip"===r.substring(i+1),r=r.substring(0,i),n?n=r:t=r),{moduleName:t,ext:n,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,o){var i,a,s,l=t.xdRegExp.exec(e);return l?(i=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(i&&i!==n||a&&a.toLowerCase()!==r.toLowerCase()||(s||a)&&s!==o)):!0},finishLoad:function(e,n,r,o){r=n?t.strip(r):r,p.isBuild&&(E[e]=r),o(r)},load:function(e,n,r,o){if(o.isBuild&&!o.inlineText)return void r();p.isBuild=o.isBuild;var i=t.parseName(e),a=i.moduleName+(i.ext?"."+i.ext:""),s=n.toUrl(a),l=p.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void r():void(!c||l(s,u,f,d)?t.get(s,function(n){t.finishLoad(e,i.strip,n,r)},function(e){r.error&&r.error(e)}):n([a],function(e){t.finishLoad(i.moduleName+"."+i.ext,i.strip,e,r)}))},write:function(e,n,r){if(E.hasOwnProperty(n)){var o=t.jsEscape(E[n]);r.asModule(e+"!"+n,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,n,r,o,i){var a=t.parseName(n),s=a.ext?"."+a.ext:"",l=a.moduleName+s,c=r.toUrl(a.moduleName+s)+".js";t.load(l,r,function(){var n=function(e){return o(c,e)};n.asModule=function(e,t){return o.asModule(e,c,t)},t.write(e,l,n,i)},i)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var o=n.readFileSync(e,"utf8");0===o.indexOf("﻿")&&(o=o.substring(1)),t(o)}catch(i){r(i)}}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,n,r,o){var i,a=t.createXhr();if(a.open("GET",e,!0),o)for(i in o)o.hasOwnProperty(i)&&a.setRequestHeader(i.toLowerCase(),o[i]);p.onXhr&&p.onXhr(a,e),a.onreadystatechange=function(){var t,o;4===a.readyState&&(t=a.status,t>399&&600>t?(o=new Error(e+" HTTP status: "+t),o.xhr=a,r(o)):n(a.responseText),p.onXhrComplete&&p.onXhrComplete(a,e))},a.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,r,o="utf-8",i=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),o)),l="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),null!==r&&n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);l=String(n.toString())}finally{s.close()}t(l)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(r=Components.classes,o=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),i="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,a,s,l={};i&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),n.init(s,1,0,!1),a=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),a.init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(n.available(),l),a.close(),n.close(),t(l.value)}catch(c){throw new Error((s&&s.path||"")+": "+c)}}),t}),define("text!htmlContent/New-Project-Dialog.html",[],function(){return'<div class="new-project-dialog modal">\n    <div class="modal-header">\n        <h1 class="dialog-title">{{ExtensionStrings.DIALOG_TITLE}}</h1>\n    </div>\n    <div class="modal-body">\n        <div class="field-container input-field">\n            <p class="npd-half-layout">\n                <label class="npd-label" for="project-name">{{ExtensionStrings.PROJECT_NAME_LABEL}}</label>\n                <input type="text" placeholder="{{NEXT_NEW_PROJECT_NAME}}" id="project-name"/>\n            </p>\n            <p class="npd-half-layout">\n                <label id="template-part" class="npd-label">{{ExtensionStrings.CHOOSE_TEMPLATE_LABEL}} <span>(in templateFiles Folder)</span></label>\n                <select id="project-template" required>\n                    <option id="none">{{ExtensionStrings.NO_TEMPLATE_OPTION_LABEL}}</option>\n                </select>                \n            </p>\n        </div>\n        <div class="field-container input-field">\n            <label class="npd-label" for="project-directory">{{ExtensionStrings.PROJECT_DIRECTORY_lABEL}}</label>\n            <input type="text" value="{{PROJECT_DIRECTORY}}" id="project-directory" readonly/>\n            <button id="change-directory" class="dialog-button btn">{{ExtensionStrings.CHANGE}}</button>\n        </div>    \n    </div>\n    <div class="modal-footer">\n        <button class="dialog-button btn" data-button-id="cancel">{{Strings.CANCEL}}</button>\n        <button class="dialog-button btn primary" data-button-id="ok">{{Strings.OK}}</button>\n    </div>\n</div>\n'}),define("main",["require","exports","module","strings","text!htmlContent/New-Project-Dialog.html"],function(e,t,n){function r(e){return"win"===brackets.platform&&(e=e.replace(new RegExp(/\//g),"\\")),e}function o(e){return k.convertWindowsPathToUnixPath(e)}function i(e){if(e&&e.length){var t=e[e.length-1];"/"!==t&&(e+="/")}return e}function a(e){if(e&&e.length){var t=e[e.length-1];e=k.getDirectoryPath("/"!==t?e:e.slice(0,-1))}return e}function s(e){return k.getBaseName(e)}function l(){return k.getNativeModuleDirectoryPath(Z)+"/templateFiles"}function c(){return tt.get("userTemplatesFolder")}function u(e,t){var n;n=e===H?U.ONE_OR_MORE_TEMPLATE_FILES_FAILED:e===Y?U.ERROR_NOT_A_DIRECTORY:e===brackets.fs.ERR_FILE_EXISTS?U.ERROR_DIRECTORY_ALREADY_EXISTS:U.ERROR_UNABLE_TO_WRITE_DIRECTORY,S.showModalDialog(j.DIALOG_ID_ERROR,U.DIALOG_TITLE,x.format(n,e,r(t)))}function f(e){return-1!==e.search(/[\/?*:;\{\}<>\\|]+/)||e.match(Q)?(S.showModalDialog(j.DIALOG_ID_ERROR,U.INVALID_PROJECT_NAME,U.INVALID_PROJECT_NAME_MESSAGE),!1):!0}function d(e,t){var n=new $.Deferred,r=i(e)+s(t);return brackets.fs.stat(r,function(e,o){e===brackets.fs.ERR_NOT_FOUND?brackets.fs.copyFile(t,r,function(e){e===brackets.fs.NO_ERROR?n.resolve():n.reject(e)}):n.reject(e===brackets.fs.NO_ERROR?o.isDirectory()?brackets.fs.ERR_CANT_WRITE:brackets.fs.ERR_FILE_EXISTS:e)}),n}function E(e,t){var n,r=0,o=0,a=new $.Deferred;return t&&e?(brackets.fs.readdir(t,function(l,c){if(l===brackets.fs.NO_ERROR){var u=c.indexOf(G);u>=0&&(c=c.slice(0,u).concat(c.slice(u,-1)));var f=function(){++o},p=function(){++r===c.length&&a.resolve(o)},g=function(e,t){brackets.fs.stat(t,function(n,r){r.isFile()?d(e,t).fail(f).always(p):r.isDirectory()&&(e=i(e)+s(t),brackets.fs.makedir(e,777,function(n){n===brackets.fs.NO_ERROR?E(e,t).fail(f).always(p):++o}))})};for(n=0;n<c.length;n++)g(e,i(t)+c[n]);0===c.length&&a.resolve(0)}else l===brackets.fs.ERR_NOT_FOUND?a.resolve(0):a.reject(l)}),a):a.resolve(0)}function p(e,t){return E(e,t.dir)}function g(e,t){var n=new $.Deferred;return brackets.fs.makedir(e,777,function(r){r===brackets.fs.NO_ERROR?p(e,t).done(function(t){t&&t>0?(u(H,e),n.reject()):n.resolve()}).fail(function(t){u(t,e),n.reject(t)}):(u(r,e),n.reject(r))}),n}function R(e,t){var n=a(e),r=new $.Deferred;return brackets.fs.stat(n,function(o,i){o===brackets.fs.NO_ERROR&&i.isDirectory()?g(e,t).done(function(){r.resolve()}).fail(function(){r.reject()}):(u(Y,n),r.reject())}),r}function _(e,t){var n=i(e)+t;brackets.fs.stat(n,function(e,t){e===brackets.fs.NO_ERROR&&t.isFile()&&A.execute(M.FILE_ADD_TO_WORKING_SET,{fullPath:n})})}function v(e,t){t.hasOwnProperty("starterFilename")?_(e,t.starterFilename,t):_(e,V,t)}function m(e,t,n){var r=i(t)+n,o=function(t,o){o.isDirectory()&&e.append('<option id="Template_'+(K++).toString()+'" source="'+r+'">'+n+"</option>")};brackets.fs.stat(r,o)}function O(e,t){var n,r=$.Deferred();return brackets.fs.readdir(t,function(o,i){if(o===brackets.fs.NO_ERROR)for(n=0;n<i.length;n++)m(e,t,i[n]);r.resolve()}),r}function T(e){var t=$.Deferred();return O(e,l()).always(function(){O(e,c()).always(function(){t.resolve()})}),t}function b(e){var t={},n=new $.Deferred,r=i(e.dir)+G;return brackets.fs.stat(r,function(e){e!==brackets.fs.NO_ERROR?n.resolve(t):brackets.fs.readFile(r,"utf8",function(e,r){e===brackets.fs.NO_ERROR&&(t=$.extend({},t,JSON.parse(r))),n.resolve(t)})}),n}function h(){var e,t="",n="0123456789";for(e=0;5>e;e++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function N(e,t,n){var o=new $.Deferred,a=r(e),s=U.NEW_PROJECT_BASE_NAME+t.toString(),l=i(a)+s;return brackets.fs.stat(l,function(r){r===brackets.fs.ERR_NOT_FOUND?o.resolve({status:W,newProjectName:s,ordinal:t}):r!==brackets.fs.NO_ERROR?(t=h(),o.resolve({status:q,reason:"unknown-error",newProjectName:U.NEW_PROJECT_BASE_NAME+t,ordinal:t})):n&&n>100?(t=h(),o.resolve({status:q,reason:"max-try-limit-hit",newProjectName:U.NEW_PROJECT_BASE_NAME+t,ordinal:t})):N(e,t+1,n?n+1:1).done(function(e){o.resolve(e)})}),o}function P(){var e,t,n,a,s,l,c=tt.get("newProjectOrdinal")||1,u=tt.get("newProjectsFolder")||et;N(u,c).done(function(c){var d=c.newProjectName,E={Strings:I,ExtensionStrings:U,PROJECT_DIRECTORY:r(u),NEXT_NEW_PROJECT_NAME:d},p=function(){var e=l[0].selectedIndex,t=l.children("option").eq(e),n=t?t.attr("source")||"":"",r=t&&1===t.length?t[0].innerText||"":"";return{name:r,dir:n}},g=S.showModalDialogUsingTemplate(Mustache.render(B,E));g.done(function(e){if("ok"===e){var t=o(a.val()),n=s.val(),r=i(t)+(n.length>0?n:d),l=p();b(l).done(function(e){R(r,l,e).done(function(){y.openProject(r).done(function(){v(r,e)}),n===d&&c.status===W&&tt.set("newProjectOrdinal",++c.ordinal)})})}}),e=g.getElement(),t=e.find(".dialog-button[data-button-id='ok']"),n=$("#change-directory",e),a=$("#project-directory",e),s=$("#project-name",e),l=$("#project-template",e),n.click(function(e){F.showOpenDialog(!1,!0,I.CHOOSE_FOLDER,u,null,function(e,t){!e&&t&&t.length>0&&t[0].length>0&&(u=t[0],a.val(r(u)),tt.set("newProjectsFolder",u))}),e.preventDefault(),e.stopPropagation()}),t.click(function(e){f(s.val())||(e.preventDefault(),e.stopPropagation())}),T(l)})}function w(){return i(et)+z}var y=brackets.getModule("project/ProjectManager"),L=brackets.getModule("preferences/PreferencesManager"),M=brackets.getModule("command/Commands"),A=brackets.getModule("command/CommandManager"),D=brackets.getModule("utils/ExtensionUtils"),I=brackets.getModule("strings"),x=brackets.getModule("utils/StringUtils"),C=brackets.getModule("command/Menus"),k=brackets.getModule("file/FileUtils"),j=brackets.getModule("widgets/DefaultDialogs"),S=brackets.getModule("widgets/Dialogs"),F=brackets.getModule("filesystem/FileSystem"),U=e("strings"),B=e("text!htmlContent/New-Project-Dialog.html"),X="BracketsNewProjectExtension",J="file.newProject",H=-9e3,Y=-9001,W=1,q=0,G="template.json",V="index.html",z="BracketsProjectTemplates",K=0,Q=/^(\.+|com[1-9]|lpt[1-9]|nul|con|prn|aux)$/i,Z=n,et=brackets.app.getUserDocumentsDirectory(),tt=L.getExtensionPrefs(X);tt.definePreference("newProjectsFolder","string",""),tt.definePreference("userTemplatesFolder","string",w()),tt.definePreference("newProjectOrdinal","number",1),D.loadStyleSheet(n,"styles/styles.css"),A.register(U.MENU_TITLE,J,P);var nt=C.getMenu(C.AppMenuBar.FILE_MENU);nt.addMenuItem(J,void 0,C.AFTER,M.FILE_NEW_UNTITLED)});